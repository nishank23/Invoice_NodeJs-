<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Invoice</title>

    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 210mm;
            height: 275mm;
            margin: auto;
            font-family: "Poppins", sans-serif;
        }

        .invoice_pdf {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        footer {
            padding-bottom: 20px;
            padding-top: 20px;
        }

        p {
            font-size: 16px;
            color: #1a1919;
            margin-bottom: 5px;
            font-weight: 500;
        }

        h3 {
            margin-bottom: 5px;
            font-weight: 700;
        }

        .custom_container {
            width: 190mm;
            margin: 0 auto;
        }

        .top_line {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .top_line .dark_bdr {
            width: 100%;
            height: 25px;
            background-color: #ff771d;
        }

        .top_line .first_bdr {
            width: 80%;
        }

        .top_line .sec_bdr {
            width: 10%;
        }

        .line_text h2 {
            font-size: 40px;
            font-family: "Bebas Neue", sans-serif;
            letter-spacing: 3px;
            margin: 0;
        }

        .pdf_name .name_left h3 {
            color: #9f9f9f;
            font-size: 16px;
        }

        .pdf_name .name_left h2 {
            font-size: 16px;
            font-weight: 700;
        }

        .pdf_name .name_left p {
            font-size: 16px;
        }

        .pdf_name .name_right h3 {
            font-size: 16px;
            text-align: end;
        }

        .pdf_name .name_right p {
            text-align: right;
        }

        .pdf_table tbody th {
            font-size: 16px;
        }

        .pdf_table tbody td {
            padding-top: 16px;
            padding-bottom: 16px;
            font-size: 16px;
        }

        table {
            border: 1px solid #d0d0d0;
        }

        .logo img {
            width: 170px;
        }

        .total_amount {
            background-color: #ff771d;
            padding: 10px 5px;
        }

        .total_amount h3,
        .total_amount p {
            color: #ffffff;
            font-size: 16px;
        }

        footer .top_line .dark_bdr {
            height: 5px;
            background-color: #ff771d;
            margin-top: 35px;
        }

        footer .top_line .first_bdr {
            width: 70%;
        }

        .signature_pdf {
            flex: 1; /* Use flex to take up available space */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .signature_pdf img {
            max-height: 100px; /* Set a maximum height for the image */
            width: auto; /* Let the width scale automatically */
        }

        .bdr_btm {
            width: 100%;
            border-bottom: 1px solid #000;
        }

        .signature_pdf h3 {
            font-size: 16px;
            text-align: center;
        }

        .footer_detail {
            display: flex;
            align-items: center;
        }

        .footer_detail .bdr_right {
            width: 1px;
            height: 26px;
            background-color: #1a1919;
        }

        .line_text p {
            color: #00000080;
            font-size: 18px;
        }

        .invoice_total.pdf_name .name_right h3 {
            text-align: left;
        }

        @media print {
            footer {
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
<div class="invoice_pdf">
    <header>
        <div class="custom_container">
            <div class="row mt-4">
                <div class="col-6">
                    <div class="logo">
                        <img src="https://i.ibb.co/jgXnhDG/logo.png" alt=""/>
                    </div>
                </div>
                <div class="col-6">
                    <div class="line_text text-end">
                        <p>GST: <%= userprofile.company.gstNumber %></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="top_line">
            <div class="first_bdr dark_bdr"></div>
            <div class="line_text mx-3">
                <h2>INVOICE</h2>
            </div>
            <div class="sec_bdr dark_bdr"></div>
        </div>
    </header>

    <div class="custom_container">
        <div class="pdf_name">
            <div class="container-fluid">
                <div class="row justify-content-between align-items-center">
                    <div class="col-4">
                        <div class="name_left">
                            <h3>Invoice to:</h3>
                            <h2><%= userprofile.company.name %></h2>
                            <p><%= userprofile.company.mobileNumber %></p>
                            <p>
                                <%= userprofile.address.addressLine %>
                            </p>
                        </div>
                    </div>
                    <div class="col-7">
                        <div class="name_right">
                            <div class="row">
                                <div class="col-6">
                                    <h3>Invoice No:</h3>
                                </div>
                                <div class="col-6">
                                    <p><%= invoice.estimationNo %></p>
                                </div>
                            </div>
                            <%
                            // Parse the date string to a Date object
                            const invoiceDate = new Date(invoice.invoiceDate);

                            // Get the day, month, and year
                            const day = invoiceDate.getDate().toString().padStart(2, '0');
                            const month = (invoiceDate.getMonth() + 1).toString().padStart(2, '0'); // Note: Months are zero-indexed, so we add 1
                            const year = invoiceDate.getFullYear().toString();

                            // Construct the formatted date in the format dd-mm-yyyy
                            const invoiceDateFormatted = `${day}-${month}-${year}`;
                            %>
                            <div class="row">
                                <div class="col-6">
                                    <h3>Date:</h3>
                                </div>
                                <div class="col-6">
                                    <p><%= invoiceDateFormatted %></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <h3>GST:</h3>
                                </div>
                                <div class="col-6">
                                    <p><%= invoice.client.company.gstNumber %></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-6">
                        <div class="name_left">
                            <h3>Billed to:</h3>
                            <h2><%= invoice.client.company.name %></h2>
                            <p><%= invoice.client.company.mobileNumber %></p>
                            <p><%= invoice.client.billingAddress.addressLine %></p>
                        </div>
                    </div>
                   <!-- <div class="col-6">
                        <div class="name_left">
                            <h3>Shipped to:</h3>
                            <h2><%= invoice.shippedToName %></h2>
                            <p><%= invoice.shippedToPhone %></p>
                            <p><%= invoice.shippedToAddress %></p>
                        </div>
                    </div>-->
                </div>
            </div>
        </div>
        <div class="pdf_table my-4">
            <table class="table table-striped">
                <thead class="table-dark">
                <tr>
                    <th>SL.</th>
                    <th>Item Description</th>
                    <th>Price</th>
                    <th>QTY.</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody>
                <% invoice.products.forEach((product, index) => { %>
                    <tr>
                        <td><%= index + 1 %>.</td>
                        <td><%= product.product.name %></td>
                        <td><%= product.product.price %></td>
                        <td><%= product.quantity %></td>
                        <% const productTotal = product.product.price * product.quantity; %>
                        <td><%= product.product.currencySymbol%> <%= productTotal %></td>
                    </tr>
                <% }); %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="custom_container mt-auto">
        <div class="pdf_name invoice_total">
            <div class="container-fluid">
                <div class="row justify-content-between">
                    <div class="col-5">
                        <div class="name_left">
                            <h2 class="mb-3">Thank you for your business</h2>
                            <h3>Payment info:</h3>
                            <div class="pdf_payment_info">
                                <div class="row">
                                    <div class="col-6">
                                        <p>Bank:</p>
                                    </div>
                                    <div class="col-6">
                                        <p><%= userprofile.bank.bankName %></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <p>A/C No.</p>
                                    </div>
                                    <div class="col-6">
                                        <p><%= userprofile.bank.accountNumber %></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <p>IFSC:</p>
                                    </div>
                                    <div class="col-6">
                                        <p><%= userprofile.bank.ifscCode %></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="name_right">
                            <div class="row">
                                <div class="col-6">
                                    <h3>Sub Total:</h3>
                                </div>
                                <div class="col-6">
                                    <p><%= invoice.currency %> <%= invoice.subTotal.toFixed(2) %></p>
                                </div>
                            </div>
                            <% invoice.taxes.forEach((tax) => { %>
                                <div class="row">
                                    <div class="col-6">
                                        <h3><%= tax.name %>:</h3>
                                    </div>
                                    <div class="col-6">
                                        <p><%= tax.percentage %>%</p>
                                    </div>
                                </div>
                            <% }); %>
                            <div class="total_amount">
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="mb-0">Total:</h3>
                                    </div>
                                    <div class="col-6">
                                        <p class="mb-0"><%= invoice.currency %> <%= invoice.totalAmount.toFixed(2) %></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="top_line">
            <div class="first_bdr dark_bdr"></div>
            <div class="signature_pdf mx-4">
                <img src="<%= baseUrl %><%= invoice.sign %>" alt=""/>
                <div class="bdr_btm my-2"></div>
                <h3>Authorised Sign</h3>
            </div>
            <div class="sec_bdr dark_bdr"></div>
        </div>
        <div class="custom_container">
            <div class="footer_detail">
                <p><%= userprofile.company.mobileNumber %></p>
                <div class="bdr_right mx-3"></div>
                <p><%= userprofile.address.addressLine %></p>
            </div>
        </div>
    </footer>
</div>

<!-- js -->

<script src="//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.min.js"></script>
<script type="text/javascript">
    pdfjsLib.GlobalWorkerOptions.workerSrc = "//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.worker.min.js";
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</body>
</html>
